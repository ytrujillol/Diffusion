// Parameters
int inside = 2; 
int outside = 1;
real d=0.1;
func f=1.0;

//Mesh
border b1(t=0, 1){x=0; y=-t; label=outside;};
border b2(t=0, 1){x=t; y=-1;label=outside;};
border b3(t=0, 1){x=1; y=t-1;label=outside;};
border b4(t=0, 1){x=1; y=t;label=outside;};
border b5(t=0, 1){x=-t+1; y=1;label=outside;};
border b6(t=0, 1){x=0; y=-t+1;label=outside;};

border b7(t=0, 1){x= 0 + 0.037037037037037035 *t ; y= 0 + 0.0 *t;label=inside;};
border b8(t=0, 1){x= 0.037037037037037035 + 0.018518518518518517 *t ; y= 0.0 + 0.032075014954979206 *t;label=inside;};
border b9(t=0, 1){x= 0.05555555555555555 + 0.018518518518518517 *t ; y= 0.032075014954979206 + -0.032075014954979206 *t;label=inside;};
border b10(t=0, 1){x= 0.07407407407407407 + 0.037037037037037035 *t ; y= 0.0 + 0.0 *t;label=inside;};
border b11(t=0, 1){x= 0.1111111111111111 + 0.018518518518518517 *t ; y= 0.0 + 0.032075014954979206 *t;label=inside;};
border b12(t=0, 1){x= 0.12962962962962962 + -0.018518518518518504 *t ; y= 0.032075014954979206 + 0.032075014954979233 *t;label=inside;};
border b13(t=0, 1){x= 0.11111111111111112 + 0.03703703703703705 *t ; y= 0.06415002990995844 + -2.7755575615628914e-17 *t;label=inside;};
border b14(t=0, 1){x= 0.14814814814814817 + 0.018518518518518517 *t ; y= 0.06415002990995841 + 0.032075014954979206 *t;label=inside;};
border b15(t=0, 1){x= 0.16666666666666669 + 0.018518518518518517 *t ; y= 0.09622504486493762 + -0.032075014954979206 *t;label=inside;};
border b16(t=0, 1){x= 0.1851851851851852 + 0.03703703703703701 *t ; y= 0.06415002990995841 + -2.7755575615628914e-17 *t;label=inside;};
border b17(t=0, 1){x= 0.2222222222222222 + -0.018518518518518517 *t ; y= 0.06415002990995838 + -0.03207501495497918 *t;label=inside;};
border b18(t=0, 1){x= 0.2037037037037037 + 0.018518518518518517 *t ; y= 0.032075014954979206 + -0.032075014954979206 *t;label=inside;};
border b19(t=0, 1){x= 0.2222222222222222 + 0.037037037037037035 *t ; y= 0.0 + 0.0 *t;label=inside;};
border b20(t=0, 1){x= 0.25925925925925924 + 0.018518518518518545 *t ; y= 0.0 + 0.032075014954979206 *t;label=inside;};
border b21(t=0, 1){x= 0.2777777777777778 + 0.01851851851851849 *t ; y= 0.032075014954979206 + -0.032075014954979206 *t;label=inside;};
border b22(t=0, 1){x= 0.2962962962962963 + 0.037037037037037035 *t ; y= 0.0 + 0.0 *t;label=inside;};
border b23(t=0, 1){x= 0.3333333333333333 + 0.018518518518518545 *t ; y= 0.0 + 0.03207501495497921 *t;label=inside;};
border b24(t=0, 1){x= 0.35185185185185186 + -0.018518518518518545 *t ; y= 0.03207501495497921 + 0.0320750149549792 *t;label=inside;};
border b25(t=0, 1){x= 0.3333333333333333 + 0.037037037037037035 *t ; y= 0.06415002990995841 + 2.7755575615628914e-17 *t;label=inside;};
border b26(t=0, 1){x= 0.37037037037037035 + 0.018518518518518545 *t ; y= 0.06415002990995844 + 0.032075014954979206 *t;label=inside;};
border b27(t=0, 1){x= 0.3888888888888889 + -0.018518518518518545 *t ; y= 0.09622504486493764 + 0.032075014954979206 *t;label=inside;};
border b28(t=0, 1){x= 0.37037037037037035 + -0.03703703703703698 *t ; y= 0.12830005981991685 + 0.0 *t;label=inside;};
border b29(t=0, 1){x= 0.33333333333333337 + 0.01851851851851849 *t ; y= 0.12830005981991685 + 0.03207501495497919 *t;label=inside;};
border b30(t=0, 1){x= 0.35185185185185186 + -0.018518518518518545 *t ; y= 0.16037507477489604 + 0.03207501495497919 *t;label=inside;};
border b31(t=0, 1){x= 0.3333333333333333 + 0.037037037037037035 *t ; y= 0.19245008972987523 + 0.0 *t;label=inside;};
border b32(t=0, 1){x= 0.37037037037037035 + 0.01851851851851849 *t ; y= 0.19245008972987523 + 0.03207501495497922 *t;label=inside;};
border b33(t=0, 1){x= 0.38888888888888884 + 0.018518518518518545 *t ; y= 0.22452510468485445 + -0.03207501495497919 *t;label=inside;};
border b34(t=0, 1){x= 0.4074074074074074 + 0.037037037037037035 *t ; y= 0.19245008972987526 + 0.0 *t;label=inside;};
border b35(t=0, 1){x= 0.4444444444444444 + 0.018518518518518545 *t ; y= 0.19245008972987526 + 0.03207501495497922 *t;label=inside;};
border b36(t=0, 1){x= 0.46296296296296297 + -0.018518518518518545 *t ; y= 0.22452510468485448 + 0.032075014954979164 *t;label=inside;};
border b37(t=0, 1){x= 0.4444444444444444 + 0.037037037037037035 *t ; y= 0.25660011963983365 + 5.551115123125783e-17 *t;label=inside;};
border b38(t=0, 1){x= 0.48148148148148145 + 0.018518518518518545 *t ; y= 0.2566001196398337 + 0.03207501495497922 *t;label=inside;};
border b39(t=0, 1){x= 0.5 + 0.01851851851851849 *t ; y= 0.2886751345948129 + -0.03207501495497922 *t;label=inside;};
border b40(t=0, 1){x= 0.5185185185185185 + 0.03703703703703709 *t ; y= 0.2566001196398337 + 5.551115123125783e-17 *t;label=inside;};
border b41(t=0, 1){x= 0.5555555555555556 + -0.01851851851851849 *t ; y= 0.25660011963983376 + -0.032075014954979275 *t;label=inside;};
border b42(t=0, 1){x= 0.5370370370370371 + 0.01851851851851849 *t ; y= 0.22452510468485448 + -0.03207501495497922 *t;label=inside;};
border b43(t=0, 1){x= 0.5555555555555556 + 0.03703703703703709 *t ; y= 0.19245008972987526 + 0.0 *t;label=inside;};
border b44(t=0, 1){x= 0.5925925925925927 + 0.01851851851851849 *t ; y= 0.19245008972987526 + 0.032075014954979164 *t;label=inside;};
border b45(t=0, 1){x= 0.6111111111111112 + 0.01851851851851849 *t ; y= 0.22452510468485443 + -0.032075014954979136 *t;label=inside;};
border b46(t=0, 1){x= 0.6296296296296297 + 0.03703703703703709 *t ; y= 0.1924500897298753 + 0.0 *t;label=inside;};
border b47(t=0, 1){x= 0.6666666666666667 + -0.01851851851851849 *t ; y= 0.1924500897298753 + -0.03207501495497922 *t;label=inside;};
border b48(t=0, 1){x= 0.6481481481481483 + 0.01851851851851849 *t ; y= 0.16037507477489607 + -0.0320750149549793 *t;label=inside;};
border b49(t=0, 1){x= 0.6666666666666667 + -0.03703703703703709 *t ; y= 0.12830005981991677 + 8.326672684688674e-17 *t;label=inside;};
border b50(t=0, 1){x= 0.6296296296296297 + -0.01851851851851849 *t ; y= 0.12830005981991685 + -0.032075014954979206 *t;label=inside;};
border b51(t=0, 1){x= 0.6111111111111112 + 0.01851851851851849 *t ; y= 0.09622504486493764 + -0.032075014954979206 *t;label=inside;};
border b52(t=0, 1){x= 0.6296296296296297 + 0.03703703703703709 *t ; y= 0.06415002990995844 + 5.551115123125783e-17 *t;label=inside;};
border b53(t=0, 1){x= 0.6666666666666667 + -0.01851851851851849 *t ; y= 0.0641500299099585 + -0.03207501495497928 *t;label=inside;};
border b54(t=0, 1){x= 0.6481481481481483 + 0.01851851851851849 *t ; y= 0.03207501495497921 + -0.03207501495497921 *t;label=inside;};
border b55(t=0, 1){x= 0.6666666666666667 + 0.03703703703703698 *t ; y= 0.0 + 0.0 *t;label=inside;};
border b56(t=0, 1){x= 0.7037037037037037 + 0.0185185185185186 *t ; y= 0.0 + 0.032075014954979254 *t;label=inside;};
border b57(t=0, 1){x= 0.7222222222222223 + 0.01851851851851849 *t ; y= 0.032075014954979254 + -0.032075014954979254 *t;label=inside;};
border b58(t=0, 1){x= 0.7407407407407408 + 0.03703703703703698 *t ; y= 0.0 + 0.0 *t;label=inside;};
border b59(t=0, 1){x= 0.7777777777777778 + 0.01851851851851849 *t ; y= 0.0 + 0.03207501495497922 *t;label=inside;};
border b60(t=0, 1){x= 0.7962962962962963 + -0.01851851851851849 *t ; y= 0.03207501495497922 + 0.03207501495497929 *t;label=inside;};
border b61(t=0, 1){x= 0.7777777777777778 + 0.03703703703703709 *t ; y= 0.06415002990995851 + -6.938893903907228e-17 *t;label=inside;};
border b62(t=0, 1){x= 0.8148148148148149 + 0.01851851851851849 *t ; y= 0.06415002990995844 + 0.03207501495497922 *t;label=inside;};
border b63(t=0, 1){x= 0.8333333333333334 + 0.01851851851851849 *t ; y= 0.09622504486493766 + -0.03207501495497922 *t;label=inside;};
border b64(t=0, 1){x= 0.8518518518518519 + 0.03703703703703709 *t ; y= 0.06415002990995844 + 6.938893903907228e-17 *t;label=inside;};
border b65(t=0, 1){x= 0.888888888888889 + -0.01851851851851849 *t ; y= 0.06415002990995851 + -0.03207501495497929 *t;label=inside;};
border b66(t=0, 1){x= 0.8703703703703705 + 0.01851851851851849 *t ; y= 0.03207501495497922 + -0.03207501495497922 *t;label=inside;};
border b67(t=0, 1){x= 0.888888888888889 + 0.03703703703703698 *t ; y= 0.0 + 0.0 *t;label=inside;};
border b68(t=0, 1){x= 0.9259259259259259 + 0.0185185185185186 *t ; y= 0.0 + 0.032075014954979254 *t;label=inside;};
border b69(t=0, 1){x= 0.9444444444444445 + 0.01851851851851849 *t ; y= 0.032075014954979254 + -0.032075014954979254 *t;label=inside;};
border b70(t=0, 1){x= 0.962962962962963 + 0.03703703703703698 *t ; y= 0.0 + 0.0 *t;label=inside;};

int n = 5;
mesh Th = buildmesh(b1(n) + b2(n) + b3(n) +  b4(n) + b5(n) + b6(n) +
b70(-n)+b69(-n)+b68(-n)+b67(-n)+b66(-n)+b65(-n)+b64(-n)+b63(-n)+b62(-n)+b61(-n)+b60(-n)+
b59(-n)+b58(-n)+b57(-n)+b56(-n)+b55(-n)+b54(-n)+b53(-n)+b52(-n)+b51(-n)+b50(-n)+b49(-n)+
b48(-n)+b47(-n)+b46(-n)+b45(-n)+b44(-n)+b43(-n)+b42(-n)+b41(-n)+b40(-n)+b39(-n)+b38(-n)+
b37(-n)+b36(-n)+b35(-n)+b34(-n)+b33(-n)+b32(-n)+b31(-n)+b30(-n)+b29(-n)+b28(-n)+b27(-n)+
b26(-n)+b25(-n)+b24(-n)+b23(-n)+b22(-n)+b21(-n)+b20(-n)+b19(-n)+b18(-n)+b17(-n)+b16(-n)+
b15(-n)+b14(-n)+b13(-n)+b12(-n)+b11(-n)+b10(-n)+b9(-n)+b8(-n)+b7(-n));
plot(Th, wait=true);

// Fespace
fespace Vh(Th, P1);
Vh u, v,ux,uy;

solve smoothcrack(u, v)
  = int2d(Th)(dx(u)*dx(v) + dy(u)*dy(v))
  +int1d(Th,inside)(-d*N.y*dx(u)*dx(v)+d*N.x*dy(u)*dy(v) ) - int2d(Th)(f*v) + on(outside,u=0);
plot(u, value=true, fill=true, wait=true);

ux=dx(u);
uy=dy(u);